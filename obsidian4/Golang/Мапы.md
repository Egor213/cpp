–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é unsage.Pointer - –æ–Ω –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —á—Ç–æ —É–≥–æ–¥–Ω–æ, –ª—é–±–æ–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö.

–ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∏–ø–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–µ —Ç–∏–ø–æ–≤ `type descriptor` 
–û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ `equal`,`copy` –∏ —Ö—Ä–∞–Ω–∏—Ç –¥—Ä—É–≥—É—é –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (`size`)
–ü–æ —Å—É—Ç–∏ —ç—Ç–æ –æ–±—ã—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ –≤—Å–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

–£ –∫–∞–∂–¥–æ–π –º–∞–ø—ã –∫–ª—é—á –∏ –∑–Ω–∞—á–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è —Ç–∏–ø–∞–º–∏ `type descriptor`, —Ç–∞–∫ –∂–µ —Ç–∏–ø –º–∞–ø—ã —Ö—Ä–∞–Ω–∏—Ç –±–∞–∫–µ—Ç—ã - —Ç–æ–∂–µ *_type*. –í–Ω—É—Ç—Ä–∏ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `hasher`, –∫–æ—Ç–æ—Ä–∞—è —Ö—ç—à–∏—Ä—É–µ—Ç –∫–ª—é—á–∏

–£ –º–∞–ø—ã –µ—Å—Ç—å loadFactor, –ø–æ—Å–ª–µ —á–µ–≥–æ –Ω–∞—á–∏—é—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –Ω–æ–≤—ã–µ –±–∞–∫–µ—Ç—ã –∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–µ–∑–∂–∞—Ç—å —Ç—É–¥–∞. –ë–∞–∫–µ—Ç —Ö—Ä–∞–Ω–∏—Ç 8 —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –≠–≤–∞–∫—É–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ —Å—Ä–∞–∑—É, –∞ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –∫—É—á—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞ —Ä–∞–∑

Go –¥–µ–ª–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–ª–µ–¥—É—é—â–µ–µ:
1. –í—ã—á–∏—Å–ª—è–µ—Ç **—Ö–µ—à –∫–ª—é—á–∞** (`h = hash("key")`).
2. –ù–∞—Ö–æ–¥–∏—Ç **–Ω–æ–º–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã**: `bucketIndex = h % N`, –≥–¥–µ `N` ‚Äì –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä–∑–∏–Ω.
3. –ò–¥—ë—Ç –≤ –Ω–∞–π–¥–µ–Ω–Ω—ã–π bucket.
4. –í–Ω—É—Ç—Ä–∏ bucket —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ "—Å–ª–æ—Ç–æ–≤" (–¥–æ 8 –∫–ª—é—á–µ–π). Go —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∫–ª—é—á–∏:
    - –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç **–±—ã—Å—Ç—Ä—É—é –º–∞—Å–∫—É** (—á–∞—Å—Ç—å —Ö–µ—à–∞, —Ö—Ä–∞–Ω–∏—Ç—Å—è –ø—Ä—è–º–æ –≤ bucket).
    - –ü–æ—Ç–æ–º, –µ—Å–ª–∏ —Å–æ–≤–ø–∞–ª–æ, –¥–µ–ª–∞–µ—Ç **—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π** –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –±–∞–π—Ç –∑–∞ –±–∞–π—Ç–æ–º).
5. –ï—Å–ª–∏ –∫–ª—é—á –Ω–∞–π–¥–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.
6. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∏–¥—ë—Ç –≤ **overflow bucket** (–µ—Å–ª–∏ –µ—Å—Ç—å).
7. –ï—Å–ª–∏ —Ç–∞–∫ –∏ –Ω–µ –Ω–∞—à—ë–ª ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `zero value` –∏ `ok = false`.

---

## ü™£ –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω bucket –≤ Go

–£–ø—Ä–æ—â—ë–Ω–Ω–æ, –∫–∞–∂–¥—ã–π **bucket** –≤ `map` ‚Äî —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∞—è (–≤–Ω—É—Ç—Ä–∏ runtime):

```go
type bmap struct {
    tophash [8]uint8   // "–±—ã—Å—Ç—Ä–∞—è –º–∞—Å–∫–∞" (—á–∞—Å—Ç—å —Ö–µ—à–∞ –¥–ª—è 8 –∫–ª—é—á–µ–π)
    keys    [8]KeyType // –∫–ª—é—á–∏
    values  [8]ValType // –∑–Ω–∞—á–µ–Ω–∏—è
    overflow *bmap     // —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ overflow bucket
}
```

–¢–æ –µ—Å—Ç—å:
- –û–¥–∏–Ω bucket —Ö—Ä–∞–Ω–∏—Ç –¥–æ **8 —ç–ª–µ–º–µ–Ω—Ç–æ–≤** (`[8]`).
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–µ –ø–æ–ª–Ω—ã–π —Ö–µ—à, –∞ **—á–∞—Å—Ç—å —Ö–µ—à–∞ (tophash)**.
- –ï—Å–ª–∏ bucket –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è overflow bucket (—Å–Ω–æ–≤–∞ –¥–æ 8 —Å–ª–æ—Ç–æ–≤).
---
## üîë –ß—Ç–æ –∑–∞ `tophash` (–±—ã—Å—Ç—Ä–∞—è –º–∞—Å–∫–∞)
`tophash` ‚Äî —ç—Ç–æ **–≤–µ—Ä—Ö–Ω–∏–µ –±–∏—Ç—ã —Ö–µ—à–∞ –∫–ª—é—á–∞**, –∫–æ—Ç–æ—Ä—ã–µ Go —Ö—Ä–∞–Ω–∏—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Å–∞–º–∏—Ö –∫–ª—é—á–µ–π.  
–ö–æ–≥–¥–∞ —Ç—ã –∏—â–µ—à—å —ç–ª–µ–º–µ–Ω—Ç:
1. –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π **—Ö–µ—à –∫–ª—é—á–∞** (64 –±–∏—Ç–∞).
2. –ò–∑ —ç—Ç–æ–≥–æ —Ö–µ—à–∞ –±–µ—Ä—ë—Ç—Å—è **–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞—Ä—à–∏—Ö –±–∏—Ç–æ–≤** ‚Üí `tophash`.
3. –í bucket —Å—Ä–∞–∑—É —Å–º–æ—Ç—Ä—è—Ç –Ω–∞ –º–∞—Å—Å–∏–≤ `tophash[8]`.
    - –ï—Å–ª–∏ –≤ `tophash[i]` –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è ‚Üí –∑–Ω–∞—á–∏—Ç –∫–ª—é—á —Ç–æ—á–Ω–æ –Ω–µ –ª–µ–∂–∏—Ç –≤ —ç—Ç–æ–º —Å–ª–æ—Ç–µ.
    - –ï—Å–ª–∏ —Å–æ–≤–ø–∞–ª ‚Üí —Ç–æ–≥–¥–∞ —É–∂–µ —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç **—Å–∞–º –∫–ª—é—á** (—Å—Ç—Ä–æ–∫—É, —á–∏—Å–ª–æ –∏ —Ç.–¥.).
üëâ –≠—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–∏—Å–∫, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ –Ω–∞–¥–æ —Å—Ä–∞–∑—É —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∫–ª—é—á–∏ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏).  
–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ—à—ë–≤–∞—è (1 –±–∞–π—Ç), –ø–æ—Ç–æ–º –¥–æ—Ä–æ–≥–∞—è.
---

## üîç –ü—Ä–∏–º–µ—Ä

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –∫–ª—é—á `"bob"`.
1. –•–µ—à–∏—Ä—É–µ–º ‚Üí `h = 0xDEADBEEFCAFEBABE`.
2. –ë–µ—Ä—ë–º –≤–µ—Ä—Ö–Ω–∏–µ 8 –±–∏—Ç ‚Üí `tophash = 0xDE`.
3. –í bucket —Å–º–æ—Ç—Ä–∏–º: –µ—Å—Ç—å –ª–∏ —Å—Ä–µ–¥–∏ `tophash[0..7]` –∑–Ω–∞—á–µ–Ω–∏–µ `0xDE`.
    - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∫–ª—é—á–∞ –Ω–µ—Ç.
    - –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á `"bob"` —Å —Ç–µ–º, —á—Ç–æ –ª–µ–∂–∏—Ç –≤ `keys[i]`.

---

### –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –≤–∑—è—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –º–∞–ø—ã?

–ü–æ—Ç–æ–º—É —á—Ç–æ –ø–æ—Å–ª–µ —ç–≤–∞–∫—É–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –∞–¥—Ä–µ—Å –ø–æ–º–µ–Ω—è–µ—Ç—Å—è –∏ —Å—Å—ã–ª–∫–∞ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π


## Sync.Map
| –¢–∏–ø / –°–ø–æ—Å–æ–±         | –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å      | –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã / —Å–∏–Ω—Ç–∞–∫—Å–∏—Å                                                                                                         | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ / –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å                                                                         |
| -------------------- | ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| `map` –æ–±—ã—á–Ω–∞—è        | ‚ùå –Ω–µ—Ç                   | `m[key] = val`, <br>`v := m[key]`, `delete(m, key)`                                                                                 | –¢–æ–ª—å–∫–æ –¥–ª—è **–æ–¥–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã** –∏–ª–∏ –µ—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `sync.Mutex`/`sync.RWMutex`                |
| `map + sync.Mutex`   | ‚úÖ –¥–∞ (—á–µ—Ä–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏) | `mu.Lock(); m[key]=val; mu.Unlock()`<br>`mu.RLock(); v:=m[key]; mu.RUnlock()`                                                       | –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏, –Ω–æ —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏                        |
| `sync.Map`           | ‚úÖ –¥–∞                    | `m.Store(key, val)`<br>`v, ok := m.Load(key)`<br>`m.Delete(key)`<br>`m.LoadOrStore(key, val)`<br>`m.Range(func(k,v any) bool{...})` | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è **—á–∞—Å—Ç–æ–≥–æ —á—Ç–µ–Ω–∏—è, —Ä–µ–¥–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π**, –Ω–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∫–ª—é—á–µ–π/–∑–Ω–∞—á–µ–Ω–∏–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `any`) |
| `map + sync.RWMutex` | ‚úÖ –¥–∞                    | `mu.RLock()/RUnlock()`, `mu.Lock()/Unlock()`                                                                                        | –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —á–∏—Ç–∞—Ç—å –∏–∑ –º–Ω–æ–≥–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏                    |
