https://www.youtube.com/watch?v=ZZJBu2o-NBU
![[Pasted image 20250903190127.png]]

Все начинается с разметки трехцветным алгоритмом. Каждый обьект красится в 1 из 3 цветов - белый, серый или черный. Изначально все обьекты белые.
+ Далее начинается сканирование корневых переменных (это обьекты из глобальной области видимости и переменные из стека потока). Их мы проверяем на наличие ссылок на кучу, если они найдены, то помечаем обьект серым цветом.
+ Выбираем серый элемент из очереди и сканируем его на наличие указателей на другие области памяти, если они найдены, то помечаются серым, а исходный объект помечается черным.
+ Повторяем обход, пока не останется серых элементов.
+ Белые элементы являются мусором.

Трехцветный алгоритм раскраски выполняется параллельно с основной программой, которая называется мутатором. Для поддерживания консистентности данных в куче используется `write barrier`.  Он следит за тем, чтобы черные элементы не указывали на белые элементы.

**По умолчанию GC вызывается, когда размер кучи становится в 2 раза больше**

Для выполнения разметки выделяется примерно 25% CPU. Включается `write barrier`, дожидаемся, пока горутины окажутся в безопасных точках. При сканировании стека работа горутин приостанавливается.


# Второй видос
https://www.youtube.com/watch?v=sGnz8xwCzWs

