–î–∞, —Ç—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥—É–º–∞–µ—à—å üëç  
–¢–∞–∫–æ–π –ø—Ä–∏—ë–º –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **asynchronous cache refresh** –∏–ª–∏ **refresh-ahead caching**.

---

## üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ö—ç—à –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π (stale)** ‚Äî –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –ø–æ TTL.
    
2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–ª—É—á–∏–≤ "—Å—Ç–∞—Ä—ã–π" –∫—ç—à, **–Ω–µ —Å—Ä–∞–∑—É –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –µ–≥–æ**, –∞:
    
    - –æ—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—á—Ç–æ–±—ã –Ω–µ —Ç–æ—Ä–º–æ–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è),
        
    - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞ –∏–∑ –ë–î –∏–ª–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.
        
3. –í –∏—Ç–æ–≥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –±—ã—Å—Ç—Ä–æ, –∞ –∫—ç—à –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ.
    

---

## üîπ –ü–ª—é—Å—ã

- –ù–µ—Ç "—à—Ç–æ—Ä–º–æ–≤ –∫—ç—à–∞" (cache stampede), –∫–æ–≥–¥–∞ –º–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±—å—é—Ç –≤ –ë–î, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏.
    
- –°–µ—Ä–≤–∏—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –±—ã—Å—Ç—Ä–æ (–æ—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ).
    
- –ö—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ.
    

---

## üîπ –ú–∏–Ω—É—Å—ã

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å **–Ω–µ–º–Ω–æ–≥–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ** (–Ω–æ –æ–±—ã—á–Ω–æ —ç—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ, –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–¥—ë—Ç –±—ã—Å—Ç—Ä–æ).
    
- –ù—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º "—Ñ–ª–∞–≥–∞ —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏—è" –∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
    

---

## üîπ –ü—Ä–∏–º–µ—Ä –≤ Go (Redis + async refresh)

```go
func GetUser(id int) (User, error) {
    key := fmt.Sprintf("user:%d", id)

    val, err := redisClient.Get(ctx, key).Result()
    if err == nil {
        var user User
        json.Unmarshal([]byte(val), &user)

        // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª—é—á "user:123:stale")
        stale, _ := redisClient.Get(ctx, key+":stale").Result()
        if stale == "1" {
            go refreshUserCache(id) // –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º
        }

        return user, nil
    }

    // –µ—Å–ª–∏ –∫—ç—à–∞ –Ω–µ—Ç ‚Äî –≥—Ä—É–∑–∏–º –∏–∑ –ë–î
    return refreshUserCache(id)
}

func refreshUserCache(id int) (User, error) {
    user, err := db.GetUser(id)
    if err != nil {
        return user, err
    }

    data, _ := json.Marshal(user)
    redisClient.Set(ctx, fmt.Sprintf("user:%d", id), data, 10*time.Minute)

    // —Å–Ω–∏–º–∞–µ–º –ø–æ–º–µ—Ç–∫—É "stale"
    redisClient.Del(ctx, fmt.Sprintf("user:%d:stale", id))

    return user, nil
}

func UpdateUser(u User) error {
    if err := db.UpdateUser(u); err != nil {
        return err
    }

    key := fmt.Sprintf("user:%d", u.ID)
    // –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è ‚Äî –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ "—É—Å—Ç–∞—Ä–µ–≤—à–∏–π"
    redisClient.Set(ctx, key+":stale", "1", 1*time.Minute)

    return nil
}
```

–ó–¥–µ—Å—å:

- –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º—ã **–Ω–µ —É–¥–∞–ª—è–µ–º** –∫—ç—à, –∞ —Å—Ç–∞–≤–∏–º —Ñ–ª–∞–≥ `"stale"`.
    
- –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç **—Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**, –Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø–æ–π–¥—ë—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ë–î.
    

---

## üîπ –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç

- CDN (Cloudflare, Akamai) ‚Üí "stale-while-revalidate".
    
- –ö—Ä—É–ø–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (Netflix, Amazon) ‚Üí —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ë–î.
    

---

üëâ –•–æ—á–µ—à—å, —è –ø–æ–∫–∞–∂—É –µ—â—ë –≤–∞—Ä–∏–∞–Ω—Ç "stale-while-revalidate" **–±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–ª–∞–≥–∞ –≤ Redis**, –∞ —á–µ—Ä–µ–∑ **–¥–≤–æ–π–Ω–æ–π TTL (hard TTL + soft TTL)**?